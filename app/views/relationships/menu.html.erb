<h2>連携する</h2>
<div>
    <p>連携コードをお持ちですか？</p>
    <%= form_with model: @relationship, url: relationships_path do |f| %>
        <%= render 'shared/error_message' , object: f.object %>
        <%= f.text_field :user_id, placeholder: "パートナーのユーザーID", class: "input input-bordered w-full max-w-xs" %>
        <%= f.text_field :invitation_code, placeholder: "連携コード", class: "input input-bordered w-full max-w-xs" %>
        <%= f.submit "登録", class: "btn" %>
    <% end %>
    <p>持っていないので、連携コードを発行する</p>
    <div class="flex flex-col items-center">
        <%= form_with model: current_user, url: relationships_invitation_code_path, data: { turbo: false } do |f| %>
            <%= render 'shared/error_message' , object: f.object %>
            <%= f.text_field :user_id, placeholder: "ユーザーID", class: "input input-bordered w-full max-w-xs" %>
            <% if current_user.related? %>
                <div class="join">
                    <%= f.radio_button :invitation_my_role, :monitor, aria: { label: "監視したい" }, checked: true, class: "join-item btn", disabled: true %>
                    <%= f.radio_button :invitation_my_role, :monitored, aria: { label: "監視されたい" }, class: "join-item btn", disabled: true %>
                </div>
                <%= f.hidden_field :invitation_my_role, value: current_user.invitation_my_role %>
                <p>役割の変更には連携の解除が必要です</p>
            <% else %>
                <div class="join">
                    <%= f.radio_button :invitation_my_role, :monitor, aria: { label: "監視したい" }, checked: true, class: "join-item btn" %>
                    <%= f.radio_button :invitation_my_role, :monitored, aria: { label: "監視されたい" }, class: "join-item btn" %>
                </div>
            <% end %>
            <%= f.submit "コード発行", class: "btn" %>
        <% end %>
    </div>
</div>
<h2>連携を解除する</h2>
<div>
    <% if current_user.related? %>
        <% if current_user.monitor? %>
            <%= link_to @monitored_user.name, relationship_path(current_user.relationship), data: { turbo_method: :delete, turbo_confirm: "このユーザーとの連携を解除しますか？"}, class: "btn" %>
        <% else %>
            <% @monitor_users.each do |user| %>
                <%= link_to user.name, relationship_path(user.relationship), data: { turbo_method: :delete, turbo_confirm: "このユーザーとの連携を解除しますか？"}, class: "btn" %>
            <% end %>
        <% end %>
    <% else %>
        <p>連携されていません</p>
    <% end %>
</div>
